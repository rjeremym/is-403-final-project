<!-- FILE: views/editIdea.ejs -->
<%- include('partials/header') %>

<div class="page-header">
    <h1>Edit Business Idea</h1>
    <% if (!isOwner) { %>
        <p class="info-message">You're editing as a collaborator</p>
    <% } %>
</div>

<% if (error) { %>
    <div class="error-message"><%= error %></div>
<% } %>

<form method="POST" action="/edit-idea/<%= idea.ideaid %>" class="idea-form">
    <div class="form-section">
        <h3>Basic Information <span class="required-note">* Required</span></h3>
        
        <div class="form-group">
            <label for="ideaname">Idea Name *</label>
            <input 
                type="text" 
                id="ideaname" 
                name="ideaname" 
                required
                value="<%= idea.ideaname %>"
            >
        </div>
        
        <div class="form-group">
            <label for="ideadescription">Description *</label>
            <textarea 
                id="ideadescription" 
                name="ideadescription" 
                required
                rows="5"
            ><%= idea.ideadescription %></textarea>
        </div>
    </div>
    
    <div class="form-section">
        <h3>Strategy & Market</h3>
        
        <div class="form-group">
            <label>Marketing Strategy (select all that apply)</label>
            <div class="checkbox-group">
                <% 
                const strategies = [
                    'Social Media Marketing',
                    'Content Marketing',
                    'Email Marketing',
                    'SEO',
                    'Paid Advertising',
                    'Influencer Marketing',
                    'Word of Mouth',
                    'Partnership Marketing'
                ];
                const selectedStrategies = idea.marketingstrategy || [];
                %>
                <% strategies.forEach(strategy => { %>
                    <label class="checkbox-label">
                        <input 
                            type="checkbox" 
                            name="marketingstrategy" 
                            value="<%= strategy %>"
                            <%= selectedStrategies.includes(strategy) ? 'checked' : '' %>
                        >
                        <%= strategy %>
                    </label>
                <% }); %>
            </div>
        </div>
        
        <div class="form-group">
            <label for="targetcustomer">Target Customer</label>
            <textarea 
                id="targetcustomer" 
                name="targetcustomer"
                rows="3"
            ><%= idea.targetcustomer || '' %></textarea>
        </div>
    </div>
    
    <div class="form-section">
        <h3>Planning & Resources</h3>
        
        <div class="form-row">
            <div class="form-group">
                <label for="estimatedcost">Estimated Cost ($)</label>
                <input 
                    type="number" 
                    id="estimatedcost" 
                    name="estimatedcost"
                    min="0"
                    step="0.01"
                    value="<%= idea.estimatedcost || '' %>"
                >
            </div>
            
            <div class="form-group">
                <label for="timeline">Timeline</label>
                <input 
                    type="text" 
                    id="timeline" 
                    name="timeline"
                    value="<%= idea.timeline || '' %>"
                >
            </div>
        </div>
        
        <div class="form-group">
            <label for="potential">Success Potential (1-10)</label>
            <input 
                type="number" 
                id="potential" 
                name="potential"
                min="1"
                max="10"
                value="<%= idea.potential || '' %>"
            >
        </div>
    </div>
    
    <div class="form-actions">
        <a href="/view-ideas" class="btn btn-secondary">Cancel</a>
        <button type="submit" class="btn btn-primary">Update Idea</button>
    </div>
</form>

<% if (isOwner) { %>
    <div class="form-section collaborators-section">
        <h3>Collaborators</h3>
        
        <% if (collaborators.length > 0) { %>
            <div class="collaborators-list">
                <% collaborators.forEach(collab => { %>
                    <div class="collaborator-item">
                        <span><%= collab.firstname %> <%= collab.lastname %> (@<%= collab.username %>)</span>
                        <form method="POST" action="/remove-collaborator/<%= idea.ideaid %>/<%= collab.userid %>" style="display: inline;">
                            <button type="submit" class="btn btn-small btn-danger">Remove</button>
                        </form>
                    </div>
                <% }); %>
            </div>
        <% } else { %>
            <p class="text-muted">No collaborators yet</p>
        <% } %>
        
        <form method="POST" action="/add-collaborator/<%= idea.ideaid %>" class="add-collaborator-form">
            <div class="form-row">
                <div class="form-group" style="flex: 1;">
                    <label for="userid">Add Collaborator</label>
                    <select id="userid" name="userid" required>
                        <option value="">Select a user...</option>
                        <% allUsers.forEach(user => { %>
                            <% if (!collaborators.find(c => c.userid === user.userid)) { %>
                                <option value="<%= user.userid %>">
                                    <%= user.firstname %> <%= user.lastname %> (@<%= user.username %>)
                                </option>
                            <% } %>
                        <% }); %>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary" style="margin-top: 24px;">Add</button>
            </div>
        </form>
    </div>
<% } %>

<%- include('partials/footer') %>